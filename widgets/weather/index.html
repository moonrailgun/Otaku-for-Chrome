<style>
#weather{
  /*text-align: right;*/
  padding: 6px;
}
#weather .city{
  font-size: 30px;
}
#weather .tips{
  font-size: 8px;
  color: #575757;
}
</style>

<div id="weather" class="otk-panel">
  <h2 class="city">上海</h2>
  <p>温度:<span class="temperature"></span>℃</p>
  <p>空气质量:<span class="aqi"></span></p>
  <p><span class="tips"></span></p>
</div>

<script>
$(function(){
  var updateWeather = function(weatherData){
    $('#weather .city').text(weatherData.city);
    $('#weather .temperature').text(weatherData.temperature);
    $('#weather .tips').text(weatherData.tips);
    $('#weather .aqi').text(weatherData.aqi);
  }
  var saveLastWeather = function(weatherData){
    var temp = Core.widgetSettings.get("weather");
    temp.lastWeatherData = weatherData
    Core.widgetSettings.set("weather",temp);
  }
  var settings = Core.widgetSettings.get("weather");
  var city = '上海';
  if(settings){
    city = settings.city;
    lastWeatherData = settings.lastWeatherData;
    updateWeather(lastWeatherData);
  }else{
    Core.widgetSettings.set("weather",{city:"上海"})
  }

  var url = 'http://wthrcdn.etouch.cn/weather_mini?city=' + city;
  $.getJSON(url, function(json, textStatus) {
    var data = {
      city:json.data.city,
      temperature: json.data.wendu,
      tips:json.data.ganmao,
      aqi:json.data.aqi,
      forecast:json.data.forecast,
    }
    updateWeather(data);
    saveLastWeather(data);
  });
});
</script>
