<style>
#translate{
  padding: 20px 6px;
  min-height: 180px!important;
}

#translate h3{
  text-align: center;
}

#translate p{
  user-select: auto;
  -webkit-user-select: auto;
}

#translate .result p{
  padding: 0 6px;
  margin: 0;
}
#translate .result > p:before{
  content: '- ';
}
#translate .result .tip {
  color: #666;
  font-size: 14px;
}
</style>

<div id="translate">
  <h3>百度即时翻译</h3>
  <textarea class="input" rows="2" placeholder="在此输入文字"></textarea>
  <span class="result"></span>
</div>

<script>
$(function(){
  var langdetect = function(query, cb){
    $.ajax({
      url: 'http://fanyi.baidu.com/langdetect',
      type: 'POST',
      dataType: 'json',
      data: {query: query},
      success:function(json){
        cb(json);
      }
    })
  }

  $('#translate .input').bind("keyup change", _.debounce(function(event){
    var query = $('#translate .input').val();
    query = $.trim(query);
    if(query != ""){
      langdetect(query, function(json){
        var lan = json.lan;
        var from = lan;
        var to;
        if(from == "en"){
          to = "zh";
        }else if(from == "zh"){
          to = "en";
        }else{
          to = "zh";
        }

        $.ajax({
          url: 'http://fanyi.baidu.com/v2transapi',
          type: 'POST',
          dataType: 'json',
          data: {
            from: from,
            to:to,
            transtype:'realtime',
            simple_means_flag:3,
            query:query
          },
          success:function(data){
            var addon = [];
            if(data.dict_result && data.dict_result.simple_means) {
              let sm = data.dict_result.simple_means;
              if(sm.word_means) {
                addon.push(sm.word_means.join('; '));
              }else {
                addon.push('');
              }
              if(sm.symbols) {
                addon.push({am: sm.symbols[0].ph_am, amv: sm.symbols[0].ph_am_mp3, en: sm.symbols[0].ph_en, env: sm.symbols[0].ph_en_mp3});
              }else {
                addon.push({am:'',amv:'',en:'',env:''});
              }
            }

            var transResult = data.trans_result.data;
            var result = $('#translate .result');
            result.html('');
            $.each(transResult, function(index, el) {
              result.append('<p>'+el.dst+'</p>');
              if(addon.length > 0) {
                let symbols='[美]'+addon[1].am+' [英]'+addon[1].en;
                result.append('<div class="tip"><p>'+symbols+'</p><p>'+addon[0]+'</p></div>')
              }
            });
          }
        })
      });
    }else {
      $('#translate .result').html('');
    }
  }, 200))
})
</script>
